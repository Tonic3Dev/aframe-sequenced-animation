<head>
    <meta name="referrer" content="origin-when-cross-origin" />
    <script src="js/aframe.min.js"></script>
    <script src="js/shaders/CopyShader.js"></script>
    <script src="js/shaders/BlendShader.js"></script>
    <script src="js/postprocessing/Pass.js"></script>
    <script src="js/postprocessing/RenderPass.js"></script>
    <script src="js/postprocessing/SavePass.js"></script>
    <script src="js/postprocessing/ShaderPass.js"></script>
    <script src="js/shaders/LuminosityHighPassShader.js"></script>
    <script src="js/postprocessing/UnrealBloomPass.js"></script>
    <script src="js/shaders/BokehShader.js"></script>
    <script src="js/postprocessing/BokehPass.js"></script>
    <script src="js/postprocessing/EffectComposer.js"></script>
    <script type="x-shader/x-vertex" id="vertexshader">
        varying vec2 vUv;
        void main() {

            vUv = uv;

            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
    </script>
    <script type="x-shader/x-fragment" id="fragmentshader">
        uniform sampler2D baseTexture;
        uniform sampler2D bloomTexture;
        varying vec2 vUv;
        void main() {
            gl_FragColor = ( texture2D( baseTexture, vUv ) + vec4( 1.0 ) * texture2D( bloomTexture, vUv ) );
        }
    </script>
    <script type="module">
        import Stats from './jsm/libs/stats.module.js';
        import { GUI } from './jsm/libs/lil-gui.module.min.js';

        const t3Loader = document.querySelector('#loaderBG');
        let mouseX = 0, mouseY = 0, evenFrame = false;
        const CAArr = [], CBArr = [];
        const scene = await new THREE.Scene();
        const camera = await new THREE.PerspectiveCamera(55, t3Loader.clientWidth / t3Loader.clientHeight, 2, 2000);
        camera.aspect = t3Loader.clientWidth / t3Loader.clientHeight;
        camera.updateProjectionMatrix();
        camera.position.z = 1000;
        scene.add(camera);

        const renderer = await new THREE.WebGLRenderer();
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(t3Loader.clientWidth, t3Loader.clientHeight);
        const composer = await new THREE.EffectComposer(renderer);
        composer.setSize(t3Loader.clientWidth, t3Loader.clientHeight);
        const renderPass = await new THREE.RenderPass(scene, camera);
        const savePass = new THREE.SavePass(new THREE.WebGLRenderTarget(renderer.getRenderTarget()));
        const blendPass = new THREE.ShaderPass(THREE.BlendShader, 'tDiffuse1');
        blendPass.uniforms['tDiffuse2'].value = savePass.renderTarget.texture;
        blendPass.uniforms['mixRatio'].value = 0.75;
        const outputPass = new THREE.ShaderPass(THREE.CopyShader);
        const darkMaterial = new THREE.MeshBasicMaterial({ color: 'black' });
        const materials = {};

        const bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(t3Loader.clientWidth, t3Loader.clientHeight), 1.5, 0.4, 0.85);
        bloomPass.exposure = 1;
        bloomPass.threshold = 0;
        bloomPass.strength = 6;
        bloomPass.radius = 0;

        const bokehPass = new THREE.BokehPass(scene, camera, { focus: 1.0, aspect: camera.aspect, aperture: 0.025, maxblur: 128 });

        composer.addPass(renderPass);
        renderPass.renderToScreen = true;
        composer.addPass(blendPass);
        blendPass.renderToScreen = true;
        composer.addPass(savePass);
        savePass.renderToScreen = true;
        composer.addPass(outputPass);
        outputPass.renderToScreen = true;
        composer.addPass(bokehPass);
        bokehPass.renderToScreen = true;
        composer.addPass(bloomPass);
        bloomPass.renderToScreen = true;
        const geometryA = new THREE.BufferGeometry(), geometryB = new THREE.BufferGeometry(), geometryCA = new THREE.BufferGeometry(), geometryCB = new THREE.BufferGeometry();
        const verticesA = [], verticesB = [], verticesCA = [], verticesCB = [];
        const sprite = new THREE.TextureLoader().load('/disc.png');

        for (let i = 0; i < Math.ceil(1000 * (Math.random() + 0.1)); i++) {
            const x = t3Loader.clientWidth * 4 * Math.random() - t3Loader.clientWidth;
            const y = t3Loader.clientHeight * Math.random() - t3Loader.clientHeight / 2;
            const z = t3Loader.clientWidth * 4 * Math.random() - t3Loader.clientWidth;
            if (i % 2) {
                verticesA.push(x, y, z);
            } else {
                verticesB.push(x, y, z);
            }
            if (i % 10) {
                if (Math.random() > 0.5) {
                    verticesCA.push(t3Loader.clientWidth / 4 * Math.random() - t3Loader.clientWidth / 8, t3Loader.clientHeight / 7 * Math.random() - t3Loader.clientHeight / 14, t3Loader.clientWidth / 4 * Math.random() - t3Loader.clientWidth / 8);
                } else {
                    verticesCB.push(t3Loader.clientWidth / 2 * Math.random() - t3Loader.clientWidth / 4, t3Loader.clientHeight / 8 * Math.random() - t3Loader.clientHeight / 16, t3Loader.clientWidth / 2 * Math.random() - t3Loader.clientWidth / 4);
                }
            }
        }
        geometryA.setAttribute('position', new THREE.Float32BufferAttribute(verticesA, 3));
        geometryB.setAttribute('position', new THREE.Float32BufferAttribute(verticesB, 3));
        geometryCA.setAttribute('position', new THREE.Float32BufferAttribute(verticesCA, 3));
        geometryCB.setAttribute('position', new THREE.Float32BufferAttribute(verticesCB, 3));

        const materialA = new THREE.PointsMaterial({ size: 35, sizeAttenuation: true, map: sprite, alphaTest: 0, transparent: true });
        materialA.color.set('rgb(255, 140, 33)');
        materialA.opacity = Math.random() * 0.65;
        const materialB = new THREE.PointsMaterial({ size: 35, sizeAttenuation: true, map: sprite, alphaTest: 0, transparent: true });
        materialB.color.set('rgb(255, 140, 33)');
        materialB.opacity = Math.random() * 0.65;
        const materialCA = new THREE.PointsMaterial({ size: 15, sizeAttenuation: true, map: sprite, alphaTest: 0, transparent: true });
        materialCA.color.set('rgb(255, 140, 33)');
        materialCA.opacity = 1;
        const materialCB = new THREE.PointsMaterial({ size: 10, sizeAttenuation: true, map: sprite, alphaTest: 0, transparent: true });
        materialCB.color.set('rgb(255, 140, 33)');
        materialCB.opacity = 0.75;
        const particlesA = new THREE.Points(geometryA, materialA), particlesB = new THREE.Points(geometryB, materialB), particlesCA = new THREE.Points(geometryCA, materialCA), particlesCB = new THREE.Points(geometryCB, materialCB);
        await scene.add(particlesA, particlesB, particlesCA, particlesCB);
        await t3Loader.appendChild(composer.renderer.domElement);
        const stats = new Stats();
        //t3Loader.appendChild(stats);
        animate();

        function onWindowResize() {
            camera.aspect = t3Loader.clientWidth / t3Loader.clientHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(t3Loader.clientWidth, t3Loader.clientHeight);
            composer.setSize(t3Loader.clientWidth, t3Loader.clientHeight);
        }
        window.addEventListener('resize', function () {
            onWindowResize();
        });

        async function onPointerMove(event) {
            if (window.navigator.userAgent.includes('iPhone')) {
                mouseX = event.offsetX - t3Loader.clientWidth;
                mouseY = event.offsetY - t3Loader.clientHeight;
            } else {
                mouseX = event.offsetX - t3Loader.clientWidth / 2;
                mouseY = event.offsetY - t3Loader.clientHeight / 2;
            }

            particlesCA.position.y = (- mouseY - scene.position.y) * 1.1;
            particlesCB.position.y = (- mouseY - scene.position.y) * 1.1;
            particlesCA.position.x = (mouseX + scene.position.x);
            particlesCB.position.x = (mouseX + scene.position.x);
            particlesA.material.opacity < 0.65 && (particlesA.material.opacity += 0.05);
            particlesB.material.opacity < 0.65 && (particlesB.material.opacity += 0.05);
            particlesCA.material.opacity < 1 && (particlesCA.material.opacity += 0.025);
            particlesCB.material.opacity < 0.75 && (particlesCB.material.opacity += 0.025);

            if (CAArr.length < 32) {
                await CAArr.push(new THREE.Points(geometryCA, materialCA));
                CAArr[CAArr.length - 1].position.y = particlesCA.position.y;
                CAArr[CAArr.length - 1].position.x = particlesCA.position.x;
                CAArr[CAArr.length - 1].rotation.y = particlesCA.rotation.y;
                await scene.add(await CAArr[CAArr.length - 1]);
            }
            if (CBArr.length < 32) {
                await CBArr.push(new THREE.Points(geometryCB, materialCB));
                CBArr[CBArr.length - 1].position.y = particlesCB.position.y;
                CBArr[CBArr.length - 1].position.x = particlesCB.position.x;
                CBArr[CBArr.length - 1].rotation.y = particlesCB.rotation.y;
                await scene.add(await CBArr[CBArr.length - 1]);
            }
            blendPass.uniforms['mixRatio'].value < 0.8 && (blendPass.uniforms['mixRatio'].value += 0.001);
        }
        window.addEventListener('pointermove', function (e) {
            onPointerMove(e);
        });
        document.querySelector('.t3-loader').addEventListener('click', function (e) {
            window.audioAccess = true;
        });
        async function animate() {
            requestAnimationFrame(animate);
            particlesA.rotation.y += 0.0075;
            particlesB.rotation.y += 0.0125;
            particlesCA.rotation.y += 0.025;
            particlesCB.rotation.y += 0.01875;
            particlesA.material.opacity > 0.01 && (particlesA.material.opacity -= 0.004);
            particlesB.material.opacity > 0.01 && (particlesB.material.opacity -= 0.004);
            particlesCA.material.opacity > 0 && (particlesCA.material.opacity -= 0.0075);
            particlesCB.material.opacity > 0 && (particlesCB.material.opacity -= 0.0075);

            await CAArr.map(async (_particles, _i) => {
                _particles.rotation.y += 0.025;
            });
            await CBArr.map(async (_particles, _i) => {
                _particles.rotation.y += 0.01875;
            });
            if (!evenFrame) {
                evenFrame = true;
            } else {
                blendPass.uniforms['mixRatio'].value > 0.75 && (blendPass.uniforms['mixRatio'].value -= 0.002);
                await scene.remove(CAArr[0]);
                await scene.remove(CBArr[0]);
                await CAArr.splice(0, 1);
                await CBArr.splice(0, 1);
                evenFrame = false;
            }

            stats.update();
            composer.render();
        }
    </script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="js/gesture-detector.js"></script>
    <script src="js/gesture-handler.js"></script>
    <script xmlns="http://www.w3.org/1999/xhtml" async=""
        src="https://cdn.rawgit.com/eligrey/FileSaver.js/5ed507ef8aa53d8ecfea96d96bc7214cd2476fd2/FileSaver.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
    <style>
        body {
            height: 100vh;
            width: 100vw;
            margin: 0;
            overflow: hidden !important;
            overscroll-behavior: none !important;
            background-color: #000000;
        }

        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @-webkit-keyframes superspin {
            0% {
                opacity: 0;
                -webkit-transform: scale(0.2) rotate(0deg);
            }

            15% {
                opacity: 1;
                -webkit-transform: scale(1) rotate(1090deg);
            }

            90% {
                top: 25%;
                -webkit-transform: scale(1) rotate(1090deg);
            }

            100% {
                top: 100%;
                -webkit-transform: scale(1) rotate(1090deg);
            }
        }

        @keyframes superspin {
            0% {
                opacity: 0;
                transform: scale(0.2) rotate(0deg);
            }

            15% {
                opacity: 1;
                transform: scale(1) rotate(1090deg);
            }

            90% {
                top: 25%;
                opacity: 1;
                transform: scale(1) rotate(1090deg);
            }

            100% {
                top: 100%;
                opacity: 1;
                transform: scale(1) rotate(1090deg);
            }
        }

        @-webkit-keyframes lastspin {
            0% {
                width: 100%;
                left: 0%;
                top: 25%;
                opacity: 0;
                -webkit-transform: scale(0.2) rotate(0deg);
            }

            15% {
                opacity: 1;
                -webkit-transform: scale(1) rotate(1090deg);
            }

            90% {
                -webkit-transform: scale(1) rotate(1090deg);
            }

            100% {
                top: 2.5%;
                width: 80%;
                left: 10%;
                -webkit-transform: scale(1) rotate(1090deg);
            }
        }

        @keyframes lastspin {
            0% {
                width: 100%;
                left: 0%;
                top: 25%;
                opacity: 0;
                transform: scale(0.2) rotate(0deg);
            }

            15% {
                opacity: 1;
                transform: scale(1) rotate(1090deg);
            }

            90% {
                transform: scale(1) rotate(1090deg);
            }

            100% {
                top: 2.5%;
                width: 80%;
                left: 10%;
                transform: scale(1) rotate(1090deg);
            }
        }

        @-webkit-keyframes slidedown {
            0% {
                padding-top: 0%;
                opacity: 0;
            }

            100% {
                padding-top: 50%;
                opacity: 1;
            }
        }

        @keyframes slidedown {
            0% {
                padding-top: 0%;
                opacity: 0;
            }

            100% {
                padding-top: 50%;
                opacity: 1;
            }
        }

        .action-bar-container {
            position: fixed;
            display: none;
            padding: 10px;
            bottom: 0;
            left: 0;
            width: 100%;
            background: url(img/bg-bottom.png);
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
        }

        .detail-line {
            background: #FF086E;
            width: 120px;
            height: 2px;
        }

        .action-bar-buttons {
            margin: auto;
            width: 95%;
            padding-top: 16px;
            padding-bottom: 16px;
            display: flex;
            justify-content: center;
        }

        .action-bar-button {
            display: flex;
            justify-content: center;
            flex-direction: column;
            align-items: center;
            background-color: transparent;
            color: #3E321B;
            margin: auto;
            font-family: 'Passion One';
            font-style: normal;
            font-weight: 400;
            font-size: 22.8468px;
            line-height: 25px;
            text-align: justify;
            text-transform: uppercase;
            border: none !important;
        }

        .action-bar-button:disabled {
            opacity: 0.75;
        }

        .action-bar-button svg {}

        .review-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgb(255, 255, 255);
            display: none;
            z-index: 3;
        }

        .review-modal-close-btn-container {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: flex-start;
            width: 100%;
            height: 10%;
            padding-top: 16px;
            padding-bottom: 16px;
            padding-left: 8px;
            background: url('img/bg-top.png');
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            font-family: 'Passion One';
            font-style: normal;
            font-weight: 400;
            font-size: 22.8468px;
            line-height: 25px;
            text-align: justify;
            text-transform: uppercase;
            pointer-events: none;
        }

        .review-modal-close-btn {
            background-color: rgba(0, 0, 0, 0);
            border: none !important;
            padding: 24pt 24pt 24pt 12pt;
            pointer-events: auto;
        }

        .review-modal-loader {
            position: fixed;
            top: 25%;
            z-index: -1;
            left: 50%;
            margin-left: -40px;
            border: 10px solid #f3f3f3;
            border-radius: 50%;
            border-top: 10px solid #00ff00;
            width: 80px;
            height: 80px;
            -webkit-animation: spin 2s linear infinite;
            /* Safari */
            animation: spin 2s linear infinite;
        }

        .welcome-popup {
            position: absolute;
            top: 0px;
            left: 0px;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 10;
            flex-direction: column;
        }

        .superspin {
            position: fixed;
            display: block !important;
            width: 100%;
            max-height: 60%;
            top: 25%;
            object-fit: contain;

            opacity: 0;

            /* Configure the animation for Firefox */
            -moz-animation-duration: 6s;
            -moz-animation-name: superspin;
            -moz-animation-timing-function: linear;

            /* Configure it for Chrome and Safari */
            -webkit-animation-duration: 6s;
            -webkit-animation-name: superspin;
            -webkit-animation-timing-function: cubic-bezier(0.075, 0.82, 0.165, 1);
        }

        .lastspin {
            position: fixed;
            display: block !important;
            max-height: 60%;
            top: 25%;
            object-fit: contain;

            /* Configure the animation for Firefox */
            -moz-animation-duration: 6s;
            -moz-animation-name: lastspin;
            -moz-animation-timing-function: linear;

            /* Configure it for Chrome and Safari */
            -webkit-animation-duration: 6s;
            -webkit-animation-name: lastspin;
            -webkit-animation-timing-function: cubic-bezier(0.075, 0.82, 0.165, 1);
        }

        .slidedown {
            -moz-animation-duration: 6s;
            -moz-animation-name: slidedown;
            -moz-animation-timing-function: linear;
            -webkit-animation-duration: 6s;
            -webkit-animation-name: slidedown;
            -webkit-animation-timing-function: cubic-bezier(0.075, 0.82, 0.165, 1);
        }

        .call-to-action {
            position: fixed;
            display: none;
            padding: 10pt;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 10%;
            background: url(img/bg-bottom.png);
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            flex-direction: column;
            align-items: center;
        }

        .call-to-action p {
            font-family: 'Passion One';
            font-style: normal;
            font-weight: 400;
            font-size: 23pt;
            line-height: 25pt;
            text-align: justify;
            text-transform: uppercase;

            color: #3E321B;

            text-decoration: 0.5pt solid #FFFDF9;
            text-shadow: 0px 0px 0px rgba(0, 0, 0, 0.25);
        }

        .t3-loader {
            position: absolute;
            top: 1.5%;
            left: 0px;
            width: 100%;
            height: 98.5%;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        @font-face {
            font-family: "Passion One";
            src: url('fonts/PassionOne-Regular.ttf');
        }
    </style>
</head>

<body>
    <script defer>
        function openQrScanner(url) {
            window.location.href = url;
        }
        function takePhoto() {
            const _hashtags = '#ufoMcDonalds';
            document.getElementById('review_modal').style.display = 'block';
            const myImgElem = document.getElementById('review-img');
            myImgElem.src = '';
            myImgElem.style.display = 'none';
            var _frame = document.getElementById('photo-frame'),
                _logo = document.getElementById('event-logo');
            html2canvas(document.getElementById('arjs-video')).then(async function (canvas) {
                var canvas_video = canvas.toDataURL();
                var canvas_objects = document.querySelector('[arjs]').components.screenshot.getCanvas('perspective').toDataURL();
                // ===================== Building composite canvas ====================== //
                var _canvas1 = document.getElementById('canvas1');
                _canvas1.height = canvas.height;
                _canvas1.width = canvas.width;
                var _ctx1 = _canvas1.getContext('2d');
                // Draw video background
                var img = new Image;
                img.onload = await async function () {
                    await _ctx1.clearRect(0, 0, _canvas1.width, _canvas1.height);
                    await _ctx1.drawImage(img, 0, 0, _canvas1.width, _canvas1.height, 0, 0, _canvas1.width, _canvas1.height);
                };
                img.src = canvas_video;
                // Draw 3d elements
                var ovr = new Image;
                ovr.onload = await async function () {
                    await _ctx1.drawImage(ovr, 0, 0, ovr.width, ovr.height, 0, 0, img.width, img.height);
                    if (_frame)
                        await _ctx1.drawImage(_frame, 0, 0, _frame.width + 100, _frame.height, 0, 0, _frame.width * (_canvas1.width / 380) + 100 * (_canvas1.width / 380), _frame.height * (_canvas1.height / 527));
                    if (_logo)
                        await _ctx1.drawImage(_logo, 0, 0, _logo.width, _logo.height, _canvas1.width / 2 - _logo.width * (_canvas1.height / 527) / 2, 0, _logo.width * (_canvas1.height / 527), _logo.height * (_canvas1.height / 527));
                    _ctx1.fillStyle = 'rgba(255, 255, 255, 0.75)';
                    _ctx1.font = "30px Arial";
                    _ctx1.textAlign = "center";
                    _ctx1.fillText(_hashtags, _canvas1.width / 2, _canvas1.height * 0.8);
                    // Get data from new canvas
                    var _image = await _canvas1.toDataURL("image/png");
                    myImgElem.src = _image;
                    document.getElementById('review-img').style.display = 'inline';
                    const _imgBlob = await fetch(_image);
                    const _imgFile = await new File([await _imgBlob.blob()], Date.now().toString() + '.png', { type: "image/png", lastModified: Date.now() });
                    if (navigator.canShare({ files: [_imgFile] })) {
                        await navigator.share({ files: [_imgFile], type: "image/png" });
                    }
                }
                ovr.src = canvas_objects;
            });
        }
        async function resetPosition() {
            const _old_camera = document.querySelector('[camera]');
            const _sceneEl = document.querySelector('a-scene');
            const _obj = await document.getElementById('mainPlane');
            _obj.setAttribute('rotation', '0 0 0');
            _obj.setAttribute('scale', '1 1 1');
            var _camera = document.createElement('a-entity');
            await _sceneEl.replaceChild(_camera, _old_camera);
            _camera.setAttribute('id', 'main_camera');
            _camera.setAttribute('position', '0 1.6 4');
            _camera.setAttribute('rotation', '0 0 0');
            _camera.setAttribute('look-controls', 'touchEnabled', 'false');
            _camera.setAttribute('look-controls', 'mouseEnabled', 'false');
            _camera.setAttribute('camera', 'fov', '100');
            _camera.setAttribute('camera', 'active', true);
        }
        function closeReview() {
            document.getElementById('review_modal').style.display = 'none';
        }
        function updateAudioState() {
            const audio_sources = Array.from(document.querySelectorAll('audio'));
            const audio_bgm = document.getElementById('bgm');
            const audio_ch_2 = document.getElementById('ch_2');
            const audio_btn = document.getElementById('bgm_ctrl');
            if (audio_btn.className === 'Mute') {
                audio_btn.className = 'Unmute';
                audio_btn.innerHTML = 'Unmute';
                audio_sources.forEach(audio => audio.muted = true);
            } else {
                audio_btn.className = 'Mute';
                audio_btn.innerHTML = 'Mute';
                audio_sources.forEach(audio => {
                    audio.muted = false;
                });
            }
        }
        var fps = 30, start, now, then = Date.now(), interval = 1000 / fps, delta;
        var looped = [], wobbled = [], shoot = false, shooting = false, shot = false, endScene = false;
        async function animate() {
            const abductionBtn = document.getElementById('animTrigger');
            const _mainPlane = document.getElementById('mainPlane');
            if (start === undefined) {
                start = Date.now();
            }
            if (looped.length < loadedShips) {
                looped.push(true);
                wobbled.push(Math.random() > 0.5 ? true : false);
            }
            let myReq = requestAnimationFrame(animate);
            now = Date.now();
            delta = now - then;
            if (now - start >= 23000 && !shot) {
                abductionBtn.click();
                shot = true;
                setTimeout(() => {
                    endScene = true;
                }, 10000);
            }
            for (let _i = 0; _i < loadedShips; _i++) {
                let _ent = await document.getElementById('cr_model' + _i);
                if (delta > interval && _ent) {
                    then = now - (delta % interval);
                    let _model = await _ent.object3D;
                    _model.rotation.y -= 0.1125;
                    if (loadedShips >= 3)
                        if (!shoot) {
                            if (!endScene) {
                                if (_model.position.y < 15 && !looped[_i]) {
                                    _model.position.y += 0.02;
                                } else {
                                    looped[_i] = true;
                                    _model.position.y -= 0.02;
                                    if (_model.position.y <= 3) {
                                        looped[_i] = false;
                                    }
                                }
                                if (_model.rotation.z < 0.075 && !wobbled[_i]) {
                                    _model.rotation.z += 0.005;
                                } else {
                                    wobbled[_i] = true;
                                    _model.rotation.z -= 0.005;
                                    if (_model.rotation.z < -0.075) {
                                        wobbled[_i] = false;
                                    }
                                }
                            } else {
                                !abductionBtn.hasAttribute('disabled') && (abductionBtn.setAttribute('disabled', ''));
                                if (_model.scale.x > 0) {
                                    _model.position.y += 0.02;
                                    _model.scale.x -= 0.025;
                                    _model.scale.y -= 0.025;
                                    _model.scale.z -= 0.025;
                                    _model.traverse(node => {
                                        if (node.isMesh) {
                                            node.material.opacity -= 0.005;
                                            node.material.transparent = true;
                                            node.material.needsUpdate = true;
                                        }
                                    });
                                    if (_model.scale.x < 0) unloadedShips++;
                                } else {
                                    _mainPlane.removeChild(_ent);
                                    if (unloadedShips === loadedShips) {
                                        setTimeout(() => {
                                            start = undefined;
                                            loadedShips = 0;
                                            unloadedShips = 0;
                                            biggest = 0;
                                            xArr = [];
                                            yArr = [];
                                            zArr = [];
                                            animLoop = false;
                                            looped = [];
                                            wobbled = [];
                                            shoot = false;
                                            shooting = false;
                                            shot = false;
                                            endScene = false;
                                            document.getElementById('lookup_icon').setAttribute('style', 'display: none;');
                                            cancelAnimationFrame(myReq);
                                            advance();
                                        }, 3000);
                                    }
                                }
                            }
                        } else {
                            const _mainPlane = await document.getElementById('mainPlane');
                            const _height = _model.position.y;
                            if (Array.from(_mainPlane.children).every(_en => _en.id !== 'cone')) {
                                let _cone = await document.createElement('a-entity');
                                _cone.id = 'cone';
                                await _mainPlane.appendChild(_cone);
                                await _cone.setAttribute('geometry', 'primitive: cone; radiusBottom: ' + _model.scale.x + '; radiusTop: ' + _model.scale.x / 2 + '; height: ' + _height + ';');
                                await _cone.setAttribute('material', 'side: double; opacity: 0.5;');
                                _cone.object3D.position.x = _model.position.x;
                                _cone.object3D.position.y = (_height / 2) + 0.5;
                                _cone.object3D.position.z = _model.position.z;
                                let _cow = await document.createElement('a-plane');
                                _cow.id = 'cow';
                                await _mainPlane.appendChild(_cow);
                                await _cow.setAttribute('material', 'src: img/cow.png;');
                                _cow.object3D.scale.x = _model.scale.x;
                                _cow.object3D.scale.y = _model.scale.y;
                                _cow.object3D.position.x = _model.position.x;
                                _cow.object3D.position.y = 0;
                                _cow.object3D.position.z = _model.position.z;
                                _cow.object3D.children[0].material.alphaTest = 0.1;
                            } else {
                                let _cone = await document.getElementById('cone');
                                let _pOb = await _cone.object3D;
                                _pOb.rotation.y = _model.rotation.y;
                                let _radiusBottom = await _cone.getAttribute('geometry').radiusBottom;
                                _pOb.children[0].material.opacity -= 1 / 1500;
                                _pOb.children[0].material.needsUpdate = true;
                                if (_radiusBottom > 0.001)
                                    await _cone.setAttribute('geometry', 'radiusBottom', _radiusBottom - (_model.scale.x / 600));
                                let _cow = await document.getElementById('cow');
                                let _cOb = await _cow.object3D;
                                _cOb.position.y < _cone.getAttribute('geometry').height
                                    ? ((_cOb.position.y += _cone.getAttribute('geometry').height / 600), (_cOb.scale.x -= _model.scale.x / 900), (_cOb.scale.y -= _model.scale.y / 900))
                                    : ((_cOb.children[0].material.opacity = 0));
                                if (_cOb.rotation.z < 0.15 && !wobbled[_i]) {
                                    _cOb.rotation.z += 0.01;
                                } else {
                                    wobbled[_i] = true;
                                    _cOb.rotation.z -= 0.01;
                                    if (_cOb.rotation.z < -0.15) {
                                        wobbled[_i] = false;
                                    }
                                }
                            }
                            if (!shooting) {
                                shooting = true;
                                let audio_ch_3 = document.getElementById('ch_3');
                                audio_ch_3.src = audio_ch_3.children.namedItem('abduction_ray').src;
                                audio_ch_3.play();
                                abductionBtn.setAttribute('disabled', 'true');
                                await setTimeout(async () => {
                                    let _cone = await document.getElementById('cone');
                                    if (_cone)
                                        await _mainPlane.removeChild(_cone);
                                    let _cow = await document.getElementById('cow');
                                    if (_cow)
                                        await _mainPlane.removeChild(_cow);
                                    shoot = false;
                                    shooting = false;
                                    abductionBtn.removeAttribute('disabled');
                                }, 10000);
                            }
                        }
                }
            }
        }
        function showPrompt() {
            const _paper = document.querySelector('.superspin');
            const _startBtn = document.getElementById('startbtn');
            window.scrollTo(0, 0);
            Array.from(document.querySelectorAll('.t3-loader')).map(_en => _en.style.display = 'none');
            document.querySelector('#loadedBar').style.display = 'none';
            document.querySelector('.welcome-popup').style.display = 'flex';
            setTimeout(() => {
                _paper.classList.remove('superspin');
                setTimeout(() => {
                    _paper.classList.add('superspin');
                    setTimeout(() => {
                        _paper.classList.remove('superspin');
                        setTimeout(() => {
                            _paper.classList.add('lastspin');
                            _startBtn.classList.add('slidedown');
                            setTimeout(() => {
                                _startBtn.style = 'padding-top: 50%; opacity: 1; margin: auto; background: transparent; border: transparent;';
                                _paper.style = '-webkit-transform: scale(1) rotate(1090deg); transform: scale(1) rotate(1090deg); top: 2.5%; width: 80%; left: 10%;'
                            }, 5000);
                        }, 50);
                    }, 5000);
                }, 50);
            }, 5000);
        }
        let loadedShips = 0, unloadedShips = 0, biggest = 0, xArr = [], yArr = [], zArr = [], animLoop = false;
        async function bringShips() {
            let _finished = false, _animLength = 60, _frameCount = 0;
            let scale = Math.random() * 4 + 0.5, speed = scale / _animLength;
            if (!scale < biggest) {
                biggest = scale;
            }
            const _ent = await document.createElement('a-gltf-model');
            _ent.id = 'cr_model' + loadedShips;
            loadedShips++;
            await document.getElementById('mainPlane').appendChild(_ent);
            await _ent.setAttribute('gltf-model', '#main_model');
            await _ent.setAttribute('scale', '0 0 0');
            const _obj = _ent.object3D;
            let _pX = Math.floor((Math.random() * 10) - 5), _pY = Math.floor(Math.random() * 12 + 2), _pZ = Math.floor(Math.random() * (-12) - 4);
            do {
                _pX = await Math.floor((Math.random() * 20) - 10);
            } while (xArr.includes(_pX));
            xArr.push(_pX);
            _obj.position.x = _pX;
            do {
                _pY = await Math.floor(Math.random() * 12 + 3);
            } while (yArr.includes(_pY));
            yArr.push(_pY);
            _obj.position.y = _pY;
            do {
                _pZ = await Math.floor(Math.random() * (-8) - 10);
            } while (zArr.includes(_pZ));
            zArr.push(_pZ);
            _obj.position.z = _pZ;
            let _loop = setInterval(() => {
                if (_obj.scale.x <= scale) {
                    _obj.scale.x += speed;
                    _obj.scale.y += speed;
                    _obj.scale.z += speed;
                    _obj.rotation.y += 4;
                    if (!_obj.rotation.z > 0) {
                        _obj.rotation.z = .0125;
                    } else {
                        _obj.rotation.z = -.0125;
                    }
                } else {
                    if (!_finished) {
                        _obj.rotation.y += 3;
                        _finished = !_finished;
                    } else {
                        _obj.rotation.y += 2;
                    }
                }
                _frameCount++;
                if (_frameCount >= _animLength) {
                    _obj.rotation.z = .0125;
                    _obj.scale.x = scale;
                    _obj.scale.y = scale;
                    _obj.scale.z = scale;
                    if (!animLoop) {
                        const abductionBtn = document.getElementById('animTrigger');
                        abductionBtn.removeAttribute('disabled');
                        animLoop = true;
                        animate();
                        clearInterval(_loop);
                    } else
                        clearInterval(_loop);
                }
            }, interval);
        }
        function begin() {
            let _triggered = false;
            const _welcome = document.querySelector('.welcome-popup');
            const _call = document.querySelector('.call-to-action');
            _welcome.style.display = 'none';
            _call.style.display = 'flex';
            const audio_bgm = document.getElementById('bgm');
            const audio_ch_2 = document.getElementById('ch_2');
            audio_ch_2.src = audio_ch_2.children.namedItem('lookup_audio').src;
            audio_ch_2.play();
            _call.children[1].innerHTML = '“Announcer: <br>This just in!';
            setTimeout(() => {
                _call.children[1].innerHTML = 'This just in! <br>Aliens Spotted Nearby.';
                setTimeout(() => {
                    _call.children[1].innerHTML = 'Aliens spotted Nearby. <br>Look up to the skies now!”';
                    setTimeout(() => {
                        document.getElementById('lookup_icon').removeAttribute('style');
                        _call.children[1].innerHTML = 'point camera at sky!';
                    }, 3000);
                }, 3000);
            }, 1500);
            if (!window.navigator.userAgent.includes('iPhone') && !window.navigator.userAgent.includes('Android') && Array.from(_call.children).every(item => item.id !== 'trigger')) {
                const _trigger = document.createElement('button');
                _trigger.id = 'trigger';
                _trigger.innerHTML = 'Manual Trigger';
                _trigger.onclick = () => {
                    const audio_ch_2 = document.getElementById('ch_2');
                    audio_ch_2.src = audio_ch_2.children.namedItem('scene_audio').src;
                    audio_ch_2.play();
                    _call.style.display = 'none';
                    document.querySelector('.action-bar-container').style.display = 'block';
                    bringShips();
                    setTimeout(() => {
                        bringShips();
                        setTimeout(() => {
                            bringShips();
                        }, 2000);
                    }, 2000);
                }
                _call.appendChild(_trigger);
            }
            let _listener = window.addEventListener('deviceorientation', async (ev) => {
                _call.firstChild.innerHTML = ev.beta;
                if (ev.beta > 100 && !_triggered) {
                    resetPosition();
                    const audio_ch_2 = document.getElementById('ch_2');
                    audio_ch_2.src = audio_ch_2.children.namedItem('scene_audio').src;
                    audio_ch_2.play();
                    _triggered = true;
                    start = undefined;
                    _call.style.display = 'none';
                    document.querySelector('.action-bar-container').style.display = 'block';
                    bringShips();
                    setTimeout(() => {
                        bringShips();
                        setTimeout(() => {
                            bringShips();
                        }, 2000);
                    }, 2000);
                    window.removeEventListener('deviceorientation', _listener);
                }
            }, true);
        }
        function advance() {
            const audio_bgm = document.getElementById('bgm');
            const audio_btn = document.getElementById('bgm_ctrl');
            if (audio_bgm.children.length > 0) {
                let index = Math.round(Math.random() * (audio_bgm.children.length)) - 1;
                index < 0 && (index = 0);
                audio_bgm.volume = 0.5;
                audio_bgm.src = audio_bgm.children[index].src;
                audio_bgm.play();
                audio_bgm.setAttribute('autoplay', '');
                audio_btn.style.display = 'block';
            }

            window.navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } }).then((e) => e.onactive = begin()).catch((e) => {
                alert(e);
                console.log(e);
            });
        }
        async function handlePermissions() {
            if (window.audioAccess) {
                const audio_ch_2 = document.getElementById('ch_2');
                audio_ch_2.src = audio_ch_2.children.namedItem('voices_audio').src;
                audio_ch_2.play();
                window.navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } }, e => console.log(e)).then(stream => {
                    const camera_feed = document.getElementById('arjs-video');
                    document.body.style.filter = 'sepia(70%)';
                    document.body.style.maxHeight = '100%';
                    camera_feed.srcObject = stream;
                    showPrompt();
                }).catch((e) => {
                    alert(e);
                    console.log(e);
                });
            } else {
                const _txtStart = document.createElement('p');
                _txtStart.style = "font-family: 'Passion One'; font-style: normal; font-weight: 400; font-size: 42pt; line-height: 47pt; text-align: justify; text-transform: uppercase; color: #FCFCFC; margin-block-start: 0 !important; margin-block-end: 0 !important;";
                _txtStart.innerHTML = 'Start';
                const _btnStart = document.createElement('button');
                _btnStart.style = 'border: 2pt solid #FCFCFC; border-radius: 8pt; background: rgba(0, 0, 0, 0.75);';
                _btnStart.appendChild(_txtStart);
                _btnStart.onclick = function () {
                    const audio_ch_2 = document.getElementById('ch_2');
                    audio_ch_2.src = audio_ch_2.children.namedItem('voices_audio').src;
                    audio_ch_2.play();
                    window.navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } }, e => console.log(e)).then(stream => {
                        const camera_feed = document.getElementById('arjs-video');
                        document.body.style.filter = 'sepia(70%)';
                        document.body.style.maxHeight = '100%';
                        camera_feed.srcObject = stream;
                        showPrompt();
                    }).catch((e) => {
                        alert(e);
                        console.log(e);
                    });
                };
                document.querySelector('#buttonDiv').appendChild(_btnStart);
            }
        }
        document.addEventListener('DOMContentLoaded', async () => {
            let assetCount = 0, last = 0;
            const loadProg = [];
            const assets = await document.querySelectorAll('a-asset-item');
            const assArr = await Array.from(assets);
            await assArr.map(async (_asset, _i) => {
                console.log(_asset.dataset);
                await loadProg.push(0);
                _asset.addEventListener('progress', function (event) {
                    loadProg.splice(_i, 1, event.detail.loadedBytes / event.detail.totalBytes);
                    let _loadProg = 0;
                    loadProg.map((status, i) => {
                        _loadProg += status;
                    });
                    if (_loadProg / loadProg.length * 100 > last) {
                        document.getElementById('loadedPercentage').innerHTML = (_loadProg / loadProg.length * 100).toString().slice(0, _loadProg / loadProg.length < 1 ? 2 : 3) + '% Downloaded';
                        document.getElementById('loadedBar').style.width = _loadProg / loadProg.length * 100 + '%';
                        last = _loadProg / loadProg.length * 100;
                    }
                });
                _asset.addEventListener('loaded', function (event) {
                    assetCount++;
                    loadProg.splice(_i, 1, 1);
                    let _loadProg = 0;
                    loadProg.map((status, i) => {
                        _loadProg += status;
                    });
                    if (_loadProg / loadProg.length * 100 > last) {
                        document.getElementById('loadedPercentage').innerHTML = (_loadProg / loadProg.length * 100).toString().slice(0, _loadProg / loadProg.length < 1 ? 2 : 3) + '% Downloaded';
                        document.getElementById('loadedBar').style.width = _loadProg / loadProg.length * 100 + '%';
                        last = _loadProg / loadProg.length * 100;
                    }
                    if (assetCount === assArr.length || Array.from(document.querySelector('a-assets').children).every(_ch => _ch.hasLoaded)) {
                        handlePermissions();
                    }
                });
                _asset.addEventListener('error', function (error) {
                    console.log(error);
                });
                console.log(_asset.hasLoaded);
                if (Array.from(document.querySelector('a-assets').children).every(_ch => _ch.hasLoaded)) {
                    handlePermissions();
                }
            });
        });
    </script>
    <div id="xp-container" style="display: block">
        <a-scene id="scene" loading-screen="enabled: false;" arjs embedded
            renderer="logarithmicDepthBuffer: true; antialias: true; colorManagement: true; physicallyCorrectLights: true;"
            vr-mode-ui="enabled: false" gltf-model="dracoDecoderPath: https://www.gstatic.com/draco/v1/decoders/;"
            gesture-detector>
            <a-assets timeout="15000">
                <a-asset-item id="main_model" src="models/ufo-v4.glb" crossorigin="anonymous"></a-asset-item>
            </a-assets>
            <a-entity id="mainPlane" gesture-handler rotation="0 0 0" position="0 0 0">
            </a-entity>
            <a-camera id="camera" position="0 1.6 0"></a-camera>
        </a-scene>
    </div>
    <div class="action-bar-container">
        <div class="action-bar-buttons">
            <button class="action-bar-button" id="animTrigger" onclick="shoot = true" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 44 44" fill="none">
                    <circle opacity="0.3" cx="22" cy="22" r="16.5" fill="#3E321B" />
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M13.6984 17.5283C10.7545 18.535 8.875 20.0614 8.875 21.7716C8.875 23.3571 10.4894 24.7851 13.0684 25.7853L11.3123 28.7121C11.181 28.9358 11.1433 29.2023 11.2074 29.4537C11.2715 29.705 11.4322 29.9209 11.6546 30.0544C11.877 30.1879 12.1431 30.2282 12.3951 30.1666C12.647 30.105 12.8645 29.9464 13.0002 29.7254L14.9689 26.4441C14.9767 26.4312 14.9841 26.4181 14.9913 26.4048C16.7592 26.8707 18.8106 27.166 21.0156 27.2343V31.1875C21.0156 31.4486 21.1193 31.699 21.3039 31.8836C21.4885 32.0682 21.7389 32.1719 22 32.1719C22.2611 32.1719 22.5115 32.0682 22.6961 31.8836C22.8807 31.699 22.9844 31.4486 22.9844 31.1875V27.2343C25.1894 27.166 27.2408 26.8707 29.0088 26.4048C29.0159 26.418 29.0233 26.4312 29.0311 26.4441L30.9998 29.7254C31.0657 29.8376 31.1531 29.9356 31.2571 30.0138C31.361 30.092 31.4795 30.1488 31.6055 30.181C31.7316 30.2131 31.8627 30.2199 31.9915 30.2011C32.1202 30.1822 32.2439 30.138 32.3554 30.0711C32.4669 30.0041 32.5641 29.9157 32.6413 29.811C32.7184 29.7063 32.7741 29.5873 32.805 29.4609C32.8359 29.3345 32.8414 29.2033 32.8213 29.0748C32.8011 28.9463 32.7557 28.823 32.6877 28.7121L30.9316 25.7853C33.5106 24.7851 35.125 23.3571 35.125 21.7716C35.125 20.0614 33.2455 18.5337 30.3016 17.5283C30.1388 17.9089 29.8671 18.2948 29.4248 18.6033C28.3906 19.3225 26.3312 20.0313 22 20.0313C17.6687 20.0313 15.6094 19.3225 14.5752 18.6033C14.1868 18.3354 13.8827 17.9626 13.6984 17.5283ZM23.3125 23.3125C23.3125 23.6606 23.1742 23.9944 22.9281 24.2406C22.6819 24.4867 22.3481 24.625 22 24.625C21.6519 24.625 21.3181 24.4867 21.0719 24.2406C20.8258 23.9944 20.6875 23.6606 20.6875 23.3125C20.6875 22.9644 20.8258 22.6306 21.0719 22.3844C21.3181 22.1383 21.6519 22 22 22C22.3481 22 22.6819 22.1383 22.9281 22.3844C23.1742 22.6306 23.3125 22.9644 23.3125 23.3125ZM15.4375 23.3125C15.7856 23.3125 16.1194 23.1742 16.3656 22.9281C16.6117 22.6819 16.75 22.3481 16.75 22C16.75 21.6519 16.6117 21.3181 16.3656 21.0719C16.1194 20.8258 15.7856 20.6875 15.4375 20.6875C15.0894 20.6875 14.7556 20.8258 14.5094 21.0719C14.2633 21.3181 14.125 21.6519 14.125 22C14.125 22.3481 14.2633 22.6819 14.5094 22.9281C14.7556 23.1742 15.0894 23.3125 15.4375 23.3125ZM29.875 22C29.875 22.3481 29.7367 22.6819 29.4906 22.9281C29.2444 23.1742 28.9106 23.3125 28.5625 23.3125C28.2144 23.3125 27.8806 23.1742 27.6344 22.9281C27.3883 22.6819 27.25 22.3481 27.25 22C27.25 21.6519 27.3883 21.3181 27.6344 21.0719C27.8806 20.8258 28.2144 20.6875 28.5625 20.6875C28.9106 20.6875 29.2444 20.8258 29.4906 21.0719C29.7367 21.3181 29.875 21.6519 29.875 22Z"
                        fill="#3E321B" />
                    <path
                        d="M15.5098 16.7566C15.7369 15.2925 16.48 13.9579 17.6051 12.9939C18.7301 12.0299 20.1628 11.5 21.6444 11.5H22.3558C23.8373 11.5 25.27 12.0299 26.3951 12.9939C27.5201 13.9579 28.2633 15.2925 28.4904 16.7566C28.4488 16.8488 28.383 16.9282 28.3001 16.9863C27.7567 17.3643 26.187 18.0625 22.0001 18.0625C17.8132 18.0625 16.2435 17.3643 15.7001 16.9863C15.6171 16.9282 15.5514 16.8488 15.5098 16.7566Z"
                        fill="#3E321B" />
                    <circle cx="22" cy="22" r="20.25" stroke="#3E321B" stroke-width="3" />
                </svg>
                Abduct
            </button>
            <button class="action-bar-button" onclick="takePhoto()">
                <svg xmlns="http://www.w3.org/2000/svg" width="58" height="58" viewBox="0 0 58 58" fill="none">
                    <circle opacity="0.3" cx="29" cy="29" r="22" fill="#3E321B" />
                    <path
                        d="M29 35.5625C31.8995 35.5625 34.25 33.212 34.25 30.3125C34.25 27.413 31.8995 25.0625 29 25.0625C26.1005 25.0625 23.75 27.413 23.75 30.3125C23.75 33.212 26.1005 35.5625 29 35.5625Z"
                        fill="#3E321B" />
                    <path
                        d="M42.3571 20.7273H37.8795C37.6518 20.7273 37.3695 20.584 37.1494 20.358L35.1807 17.334C35.1496 17.286 35.1148 17.2403 35.0767 17.1973C34.3967 16.4255 33.4777 16 32.4911 16H25.5089C24.5223 16 23.6033 16.4255 22.9233 17.1973C22.8852 17.2403 22.8504 17.286 22.8193 17.334L20.8506 20.3624C20.6821 20.5411 20.4454 20.7317 20.1964 20.7317V20.1408C20.1964 19.8274 20.0685 19.5268 19.8408 19.3051C19.613 19.0835 19.3042 18.959 18.9821 18.959H17.1607C16.8387 18.959 16.5298 19.0835 16.3021 19.3051C16.0744 19.5268 15.9464 19.8274 15.9464 20.1408V20.7317H15.6429C14.677 20.7327 13.751 21.1065 13.0681 21.7712C12.3851 22.4359 12.001 23.3371 12 24.2772V38.4545C12.001 39.3946 12.3851 40.2958 13.0681 40.9605C13.751 41.6252 14.677 41.999 15.6429 42H42.3571C43.323 41.999 44.249 41.6252 44.9319 40.9605C45.6149 40.2958 45.999 39.3946 46 38.4545V24.2727C45.999 23.3327 45.6149 22.4315 44.9319 21.7668C44.249 21.1021 43.323 20.7283 42.3571 20.7273ZM29 37.2727C27.559 37.2727 26.1504 36.8569 24.9523 36.0777C23.7541 35.2985 22.8203 34.1911 22.2689 32.8954C21.7174 31.5997 21.5732 30.174 21.8543 28.7985C22.1354 27.4229 22.8293 26.1595 23.8482 25.1678C24.8671 24.1761 26.1653 23.5008 27.5786 23.2272C28.9919 22.9536 30.4568 23.094 31.7881 23.6307C33.1194 24.1674 34.2573 25.0762 35.0578 26.2423C35.8584 27.4084 36.2857 28.7794 36.2857 30.1818C36.2835 32.0618 35.5152 33.8641 34.1493 35.1935C32.7835 36.5228 30.9316 37.2706 29 37.2727Z"
                        fill="#3E321B" />
                    <circle cx="29" cy="29" r="27" stroke="#3E321B" stroke-width="4" />
                </svg>
                Take Photo
            </button>
            <button class="action-bar-button" id="" onclick="" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 44 44" fill="none">
                    <circle opacity="0.3" cx="21.75" cy="22" r="16.5" fill="#3E321B" />
                    <path
                        d="M13.8751 11.8749L13.8751 32.1249C13.8757 32.3299 13.9323 32.5309 14.0386 32.7062C14.145 32.8814 14.2971 33.0244 14.4787 33.1196C14.6602 33.2149 14.8643 33.2588 15.069 33.2467C15.2737 33.2345 15.4712 33.1668 15.6402 33.0508L30.2652 22.9258C30.8716 22.5062 30.8716 21.4959 30.2652 21.0752L15.6402 10.9502C15.4715 10.833 15.2739 10.7642 15.0689 10.7514C14.8639 10.7387 14.6593 10.7823 14.4774 10.8776C14.2954 10.9729 14.1431 11.1163 14.0369 11.2921C13.9307 11.4679 13.8747 11.6695 13.8751 11.8749Z"
                        fill="#3E321B" />
                    <circle cx="21.75" cy="22" r="20.25" stroke="#3E321B" stroke-width="3" />
                </svg>
                Next
            </button>
        </div>
    </div>
    <canvas style="position: relative; top: 0; left: 0; pointer-events: none;" id="canvas1"></canvas>
    <div class="review-modal" id="review_modal">
        <div class="review-modal-close-btn-container">
            <button class="review-modal-close-btn" onclick="closeReview()"><svg xmlns="http://www.w3.org/2000/svg"
                    width="68" height="22" viewBox="0 0 68 22" fill="none">
                    <g filter="url(#filter0_i_174_453)">
                        <path d="M0 11L10 16.7735L10 5.2265L0 11ZM26 10L9 10L9 12L26 12L26 10Z" fill="#3E321B" />
                    </g>
                    <g filter="url(#filter1_i_174_453)">
                        <path
                            d="M39.62 13.42C39.62 15.8067 38.34 17 35.78 17H30.88V4.58H35.68C36.9467 4.58 37.8867 4.84 38.5 5.36C39.1133 5.86667 39.42 6.68 39.42 7.8C39.42 8.92 38.96 9.77333 38.04 10.36V10.48C39.0933 10.8933 39.62 11.8733 39.62 13.42ZM34.98 14.78C35.38 14.78 35.6467 14.6933 35.78 14.52C35.9267 14.3333 36 13.96 36 13.4C36 12.8267 35.9267 12.4267 35.78 12.2C35.6333 11.96 35.3667 11.84 34.98 11.84H34.34V14.78H34.98ZM35 9.9C35.3067 9.9 35.52 9.80667 35.64 9.62C35.76 9.43333 35.82 9.10667 35.82 8.64C35.82 8.16 35.7533 7.82667 35.62 7.64C35.5 7.44 35.2867 7.34 34.98 7.34H34.34V9.9H35ZM49.7023 17H46.3623L45.9823 15.04H43.6223L43.2423 17H40.0623L42.3423 4.58H47.4223L49.7023 17ZM45.6023 12.7L44.9023 8.26H44.7623L44.0623 12.7H45.6023ZM53.8233 10.92C53.8233 12.0933 53.9366 12.9333 54.1633 13.44C54.4033 13.9333 54.7899 14.18 55.3233 14.18C55.8566 14.18 56.6099 14.0533 57.5833 13.8L58.1033 16.62C57.0499 17.0067 55.9899 17.2 54.9233 17.2C53.3233 17.2 52.1566 16.6733 51.4233 15.62C50.7033 14.5533 50.3433 12.9733 50.3433 10.88C50.3433 8.77333 50.7233 7.16667 51.4833 6.06C52.2433 4.94 53.4833 4.38 55.2033 4.38C56.2166 4.38 57.1833 4.59333 58.1033 5.02L57.5633 8.12C56.5233 7.77333 55.7966 7.6 55.3833 7.6C54.7966 7.6 54.3899 7.86 54.1633 8.38C53.9366 8.88667 53.8233 9.73333 53.8233 10.92ZM67.7464 17H63.9664L62.4664 12.32H62.2664V17H58.9464V4.58H62.2664V9.78H62.4664L64.2664 4.58H67.9464L65.5264 11L67.7464 17Z"
                            fill="#3E321B" />
                    </g>
                    <defs>
                        <filter id="filter0_i_174_453" x="0" y="5.22656" width="26" height="15.5469"
                            filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                            <feFlood flood-opacity="0" result="BackgroundImageFix" />
                            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                            <feColorMatrix in="SourceAlpha" type="matrix"
                                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
                            <feOffset dy="4" />
                            <feGaussianBlur stdDeviation="2" />
                            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
                            <feBlend mode="normal" in2="shape" result="effect1_innerShadow_174_453" />
                        </filter>
                        <filter id="filter1_i_174_453" x="30.8799" y="4.37988" width="39.0664" height="14.8201"
                            filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                            <feFlood flood-opacity="0" result="BackgroundImageFix" />
                            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                            <feColorMatrix in="SourceAlpha" type="matrix"
                                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
                            <feOffset dx="2" dy="2" />
                            <feGaussianBlur stdDeviation="2" />
                            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0" />
                            <feBlend mode="normal" in2="shape" result="effect1_innerShadow_174_453" />
                        </filter>
                    </defs>
                </svg>
            </button>
            <p>Press and hold photo to save or share!</p>
        </div>
        <div style="width: 100%;">
            <div class="review-modal-loader" id="loader"></div>
            <img id="review-img" style="width: 100%; pointer-events: auto;" />
            <div style="width: 90%; margin: auto; pointer-events: none;">
                <p style="text-align: center;">Tap and hold on the image to save to your photos or share</p>
            </div>
        </div>
    </div>
    <div class="welcome-popup" style="display: none;"><button id="startbtn"
            style="margin: auto; background: transparent; border: transparent; opacity: 0;" onclick="advance()"><img
                src="start.png" /></button>
        <img class="superspin" src="paper2.png" style="display: none;" />
    </div>
    <div class="call-to-action" style="display: none;">
        <img id="lookup_icon" src="img/lookup_icon.svg" style="display: none;" />
        <p style="margin: auto;">What's that noise coming from above?</p>
    </div>
    <div id="loadedBar" style="position: absolute; top: 0px; height: 1.5%; background-color: white;">
    </div>
    <div class='t3-loader' id="loaderBG"></div>
    <div class='t3-loader' id="loaderFront">
        <p id="loadedPercentage"
            style="flex: 2; color: white; font-family: 'Passion One'; font-style: normal; font-weight: 400; font-size: 25pt; line-height: 27pt; text-align: justify; text-transform: uppercase; flex-basis: fit-content;">
            0%
            Downloaded</p>
        <p
            style="flex: 2; color: white; font-family: 'Passion One'; font-style: normal; font-weight: 400; font-size: 42pt; line-height: 47pt; text-align: center; text-transform: uppercase; flex-basis: fit-content;">
            THE UNIVERSE IS A VAST PLACE</p>
        <p
            style="flex: 1; color: white; font-family: 'Passion One'; font-style: normal; font-weight: 400; font-size: 18pt; line-height: 20pt; text-align: center; flex-basis: fit-content;">
            Now downloading your
            experience.</br>Drag
            your
            finger around on the screen while you wait.</p>
        <div id="buttonDiv" style="flex:2; flex-basis: fit-content;"></div>
    </div>
    <video autoplay="" muted="" playsinline="" id="arjs-video" width="100%" height="100%"
        style="position: absolute; top: 0px; left: 0px; z-index: -2; object-fit: cover;"></video>
    <audio id="bgm" preload="auto">
        <source id="rise_pm_2023" src="audio/rise_pm_2023.mp3" type="audio/mpeg" preload="auto">
        <source id="here_are_the_Ufos.pm" src="audio/here_are_the_Ufos.pm.mp3" type="audio/mpeg" preload="auto">
        <source id="in_the_skies_pm_v1" src="audio/in_the_skies_pm_v1.mp3" type="audio/mpeg" preload="auto">
    </audio>
    <audio id="ch_2" preload="auto">
        <source id="scene_audio" src="ufo.mp3" type="audio/mpeg" preload="auto">
        <source id="lookup_audio" src="look_up.mp3" type="audio/mpeg" preload="auto">
        <source id="voices_audio" src="audio/new_alien_voice_this_will_be_used.mp3" type="audio/mpeg" preload="auto">
    </audio>
    <audio id="ch_3" preload="auto">
        <source id="abduction_ray" src="audio/abduction_ray.mp3" type="audio/mpeg" preload="auto">
    </audio>
    <button id="bgm_ctrl" class="Mute" style="display: none; position: absolute; top: 10%; right: 5%;"
        onclick="updateAudioState()">Mute</button>
    <button id="shipSpawner" style="display: none; position: absolute; bottom: 30%; right: 20%;" onclick="bringShips()">
        Spawn UFO
    </button>
</body>
